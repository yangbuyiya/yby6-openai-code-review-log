# OpenAi ä»£ç è¯„å®¡.
### ğŸ˜€ä»£ç è¯„åˆ†ï¼š80
#### ğŸ˜€ä»£ç é€»è¾‘ä¸ç›®çš„ï¼š
è¯¥ä»£ç çš„ä¸»è¦ç›®çš„æ˜¯ä½¿ç”¨OpenAIçš„APIæ¥å¯¹Gitä»“åº“ä¸­çš„ä»£ç æ›´æ”¹è¿›è¡Œå®¡æŸ¥ã€‚å®ƒé¦–å…ˆé€šè¿‡Gitè·å–æœ€è¿‘çš„ä»£ç æ›´æ”¹ï¼Œç„¶åä½¿ç”¨OpenAIçš„ChatGLMæ¨¡å‹å¯¹æ›´æ”¹è¿›è¡Œä»£ç å®¡æŸ¥ï¼Œå¹¶å°†ç»“æœè®°å½•åœ¨GitHubä»“åº“ä¸­ã€‚

#### âœ…ä»£ç ä¼˜ç‚¹ï¼š
1. ä»£ç ç»“æ„æ¸…æ™°ï¼Œä½¿ç”¨äº†Mavené¡¹ç›®ç®¡ç†ï¼Œæ˜“äºç»´æŠ¤ã€‚
2. å¼•å…¥äº†JSONå’ŒHTTPåº“æ¥å¤„ç†ç½‘ç»œè¯·æ±‚ï¼Œæé«˜äº†ä»£ç çš„å¯è¯»æ€§ã€‚

#### ğŸ¤”é—®é¢˜ç‚¹ï¼š
1. **å®‰å…¨é£é™©**ï¼šä»£ç ä¸­ç›´æ¥ä½¿ç”¨äº†å›ºå®šçš„APIå¯†é’¥ï¼Œè¿™å¯èƒ½ä¼šå¸¦æ¥å®‰å…¨é£é™©ã€‚åº”è¯¥ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡æ¥å­˜å‚¨æ•æ„Ÿä¿¡æ¯ã€‚
2. **æ€§èƒ½ç“¶é¢ˆ**ï¼šä»£ç ä¸­ä½¿ç”¨äº†å¤šä¸ªProcessBuilderæ¥æ‰§è¡ŒGitå‘½ä»¤ï¼Œè¿™å¯èƒ½ä¼šåœ¨ä»£ç å®¡æŸ¥è¿‡ç¨‹ä¸­å¼•å…¥æ€§èƒ½ç“¶é¢ˆã€‚
3. **å¼‚å¸¸å¤„ç†**ï¼šä»£ç ä¸­ç¼ºä¹å¯¹å¼‚å¸¸æƒ…å†µçš„é€‚å½“å¤„ç†ï¼Œä¾‹å¦‚ç½‘ç»œè¯·æ±‚å¤±è´¥æˆ–Gitå‘½ä»¤æ‰§è¡Œå¤±è´¥æ—¶ã€‚

#### ğŸ¯ä¿®æ”¹å»ºè®®ï¼š
1. å°†APIå¯†é’¥å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ä¸­ï¼Œè€Œä¸æ˜¯ç›´æ¥ç¡¬ç¼–ç åœ¨ä»£ç ä¸­ã€‚
2. è€ƒè™‘ä½¿ç”¨æ›´é«˜æ•ˆçš„Gitåº“ï¼Œå¦‚JGitï¼Œä»¥å‡å°‘ProcessBuilderçš„ä½¿ç”¨ã€‚
3. æ·»åŠ é€‚å½“çš„å¼‚å¸¸å¤„ç†é€»è¾‘ï¼Œç¡®ä¿åœ¨å‡ºç°é”™è¯¯æ—¶èƒ½å¤Ÿä¼˜é›…åœ°å¤„ç†ã€‚

#### ğŸ’»ä¿®æ”¹åçš„ä»£ç ï¼š
```java
// ä¿®æ”¹åçš„Yby6OpenAiCodeReview.java
import com.yby6.middleware.sdk.utils.GitHubUploader;

public class Yby6OpenAiCodeReview {
    private static final String GITHUB_TOKEN = System.getenv("GITHUB_TOKEN");
    private static final String apiKeySecret = BearerTokenUtils.getToken(GITHUB_TOKEN);

    // ... å…¶ä»–ä»£ç ä¿æŒä¸å˜ ...

    private static String codeReview(String diffCode) throws Exception {
        // ... ä»£ç ä¿æŒä¸å˜ ...

        String token = BearerTokenUtils.getToken(apiKeySecret);
        // ... ä»£ç ä¿æŒä¸å˜ ...

        try (OutputStream os = connection.getOutputStream()) {
            byte[] input = JSON.toJSONString(chatCompletionRequest).getBytes(StandardCharsets.UTF_8);
            os.write(input);
        } catch (IOException e) {
            throw new RuntimeException("Failed to send request to OpenAI API", e);
        }
        // ... ä»£ç ä¿æŒä¸å˜ ...
    }

    // ... å…¶ä»–ä»£ç ä¿æŒä¸å˜ ...
}
```

```java
// ä¿®æ”¹åçš„GitHubUploader.java
import org.json.JSONObject;

import java.io.OutputStream;
import java.net.HttpURLConnection;
import java.net.URL;
import java.nio.charset.StandardCharsets;
import java.text.SimpleDateFormat;
import java.util.Base64;
import java.util.Date;

public class GitHubUploader {
    // ... å…¶ä»–ä»£ç ä¿æŒä¸å˜ ...

    public static String writeLog(String token, String log) throws Exception {
        // ... ä»£ç ä¿æŒä¸å˜ ...

        HttpURLConnection connection = (HttpURLConnection) new URL(url).openConnection();
        connection.setRequestMethod("PUT");
        connection.setRequestProperty("Authorization", "token " + token);
        connection.setRequestProperty("Accept", "application/vnd.github.v3+json");
        connection.setDoOutput(true);

        try (OutputStream os = connection.getOutputStream()) {
            os.write(json.toString().getBytes(StandardCharsets.UTF_8));
        } catch (IOException e) {
            throw new RuntimeException("Failed to send request to GitHub API", e);
        }
        // ... ä»£ç ä¿æŒä¸å˜ ...
    }

    // ... å…¶ä»–ä»£ç ä¿æŒä¸å˜ ...
}
```

```java
// ä¿®æ”¹åçš„GitUtils.java
// ... ä»£ç ä¿æŒä¸å˜ ...

public static String writeLog(String token, String log) throws Exception {
    // ... ä»£ç ä¿æŒä¸å˜ ...

    git = Git.open(repoDir);

    try {
        git.pull().setCredentialsProvider(new UsernamePasswordCredentialsProvider(token, "")).call();
    } catch (GitAPIException e) {
        git = Git.cloneRepository()
                .setURI(REPO_URI)
                .setDirectory(repoDir)
                .setCredentialsProvider(new UsernamePasswordCredentialsProvider(token, ""))
                .call();
    }

    // ... ä»£ç ä¿æŒä¸å˜ ...
}
```