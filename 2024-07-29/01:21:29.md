# OpenAi ä»£ç è¯„å®¡.
### ğŸ˜€ä»£ç è¯„åˆ†ï¼š80
#### ğŸ˜€ä»£ç é€»è¾‘ä¸ç›®çš„ï¼š
è¯¥ä»£ç é€»è¾‘æ—¨åœ¨ä½¿ç”¨OpenAIçš„APIå¯¹æäº¤çš„ä»£ç è¿›è¡Œè¯„å®¡ã€‚å®ƒé€šè¿‡GitHub Actionsè§¦å‘ï¼Œè·å–æœ€æ–°çš„ä»£ç å˜æ›´ï¼Œå‘é€ç»™OpenAIè¿›è¡Œä»£ç åˆ†æï¼Œå¹¶å°†ç»“æœä¸Šä¼ å›GitHubä»“åº“ã€‚

#### âœ…ä»£ç ä¼˜ç‚¹ï¼š
1. ä»£ç ç»“æ„æ¸…æ™°ï¼Œé€»è¾‘åˆ†æ˜ã€‚
2. ä½¿ç”¨äº†Gitå·¥å…·è¿›è¡Œä»£ç çš„æ£€å‡ºå’Œæ—¥å¿—çš„ç”Ÿæˆã€‚
3. ä½¿ç”¨äº†OpenAIçš„APIè¿›è¡Œä»£ç åˆ†æï¼Œå…·æœ‰ä¸€å®šçš„åˆ›æ–°æ€§ã€‚

#### ğŸ¤”é—®é¢˜ç‚¹ï¼š
1. **å®‰å…¨æ€§é—®é¢˜**ï¼šä»£ç ä¸­ç›´æ¥å°†`GITHUB_TOKEN`ä½œä¸ºç¯å¢ƒå˜é‡ï¼Œè¿™å¯èƒ½ä¼šå¼•èµ·å®‰å…¨é£é™©ã€‚
2. **æ€§èƒ½ç“¶é¢ˆ**ï¼šåœ¨è·å–ä»£ç å˜æ›´æ—¶ï¼Œä½¿ç”¨äº†`git diff`å‘½ä»¤ï¼Œè¿™å¯èƒ½åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹å¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚
3. **ä»£ç é‡å¤**ï¼šåœ¨`GitUtils`å’Œ`GitHubUploader`ä¸­å­˜åœ¨ç±»ä¼¼çš„ä»£ç é€»è¾‘ï¼Œå¯ä»¥è€ƒè™‘åˆå¹¶ã€‚

#### ğŸ¯ä¿®æ”¹å»ºè®®ï¼š
1. ç§»é™¤ç¯å¢ƒå˜é‡ä¸­çš„`GITHUB_TOKEN`ï¼Œä½¿ç”¨GitHub Secretsæ¥ç®¡ç†æ•æ„Ÿä¿¡æ¯ã€‚
2. è€ƒè™‘ä½¿ç”¨å¹¶è¡Œå¤„ç†æ¥æé«˜ä»£ç æ£€å‡ºçš„æ•ˆç‡ã€‚
3. åˆå¹¶`GitUtils`å’Œ`GitHubUploader`ä¸­çš„é‡å¤ä»£ç é€»è¾‘ã€‚

#### ğŸ’»ä¿®æ”¹åçš„ä»£ç ï¼š
```java
// ä¿®æ”¹åçš„GitUtils.java
package com.yby6.middleware.sdk.utils;

import org.eclipse.jgit.api.Git;
import org.eclipse.jgit.api.PullResult;
import org.eclipse.jgit.api.errors.GitAPIException;
import org.eclipse.jgit.lib.Repository;
import org.eclipse.jgit.revwalk.RevCommit;
import org.eclipse.jgit.transport.UsernamePasswordCredentialsProvider;

import java.io.File;
import java.io.FileWriter;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.Random;

public class GitUtils {
    private static final String REPO_URI = "https://github.com/yangbuyiya/yby6-openai-code-review-log.git";
    private static final String REPO_DIR = "repo";
    private static final String USERNAME = System.getenv("GITHUB_USERNAME");
    private static final String TOKEN = System.getenv("GITHUB_TOKEN");

    public static String writeLog(String log) throws Exception {
        Git git;
        File repoDir = new File(REPO_DIR);

        if (repoDir.exists()) {
            git = Git.open(repoDir);
            try {
                PullResult result = git.pull().setCredentialsProvider(new UsernamePasswordCredentialsProvider(USERNAME, TOKEN)).call();
                if (result.getFetchedFrom() != null) {
                    RevCommit commit = result.getFetchedFrom().getCommit();
                    System.out.println("Updated to commit: " + commit.getName());
                }
            } catch (GitAPIException e) {
                e.printStackTrace();
            }
        } else {
            git = Git.cloneRepository()
                    .setURI(REPO_URI)
                    .setDirectory(repoDir)
                    .setCredentialsProvider(new UsernamePasswordCredentialsProvider(USERNAME, TOKEN))
                    .call();
        }

        String dateFolderName = new SimpleDateFormat("yyyy-MM-dd#HH:mm:ss").format(new Date());
        File dateFolder = new File(repoDir, dateFolderName);
        if (!dateFolder.exists()) {
            dateFolder.mkdirs();
        }

        String fileName = generateRandomString(12) + ".md";
        File newFile = new File(dateFolder, fileName);
        try (FileWriter writer = new FileWriter(newFile)) {
            writer.write(log);
        }

        git.add().addFilepattern(dateFolderName + "/" + fileName).call();
        git.commit().setMessage("Add new file via GitHub Actions").call();
        git.push().setCredentialsProvider(new UsernamePasswordCredentialsProvider(USERNAME, TOKEN)).call();

        System.out.println("Changes have been pushed to the repository.");

        return "https://github.com/yangbuyiya/yby6-openai-code-review-log/blob/main/" + dateFolderName + "/" + fileName;
    }

    private static String generateRandomString(int length) {
        String characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
        Random random = new Random();
        StringBuilder sb = new StringBuilder(length);
        for (int i = 0; i < length; i++) {
            sb.append(characters.charAt(random.nextInt(characters.length())));
        }
        return sb.toString();
    }
}
```

```java
// ä¿®æ”¹åçš„GitHubUploader.java
package com.yby6.middleware.sdk.utils;

import org.json.JSONObject;
import java.io.OutputStream;
import java.net.HttpURLConnection;
import java.net.URL;
import java.nio.charset.StandardCharsets;
import java.text.SimpleDateFormat;
import java.util.Base64;

public class GitHubUploader {
    private static final String REPO_OWNER = "yangbuyiya";
    private static final String REPO_NAME = "yby6-openai-code-review-log";
    private static final String BRANCH = "main";
    private static final String USERNAME = System.getenv("GITHUB_USERNAME");
    private static final String TOKEN =