# OpenAi ä»£ç è¯„å®¡. æ¨¡å¼: GPT-4o 
### ğŸ˜€ä»£ç è¯„åˆ†ï¼š85
#### ğŸ˜€ä»£ç é€»è¾‘ä¸ç›®çš„ï¼š
æœ¬æ¬¡ä»£ç ä¿®æ”¹ä¸»è¦æ¶‰åŠ`pom.xml`æ–‡ä»¶å’Œ`Yby6OpenAiCodeReview.java`æ–‡ä»¶ã€‚ç›®çš„æ˜¯æ›´æ–°ä¾èµ–é¡¹ï¼Œä¼˜åŒ–ä»£ç è¯„å®¡åŠŸèƒ½ï¼Œå¹¶å¼•å…¥æ–°çš„æ¨¡å‹`GPT4o`ä»¥å¢å¼ºä»£ç è¯„å®¡çš„èƒ½åŠ›ã€‚
#### âœ…ä»£ç ä¼˜ç‚¹ï¼š
1. **ä¾èµ–ç®¡ç†**ï¼šç§»é™¤äº†ä¸å¿…è¦çš„ä¾èµ–é¡¹ï¼Œå‡å°‘äº†é¡¹ç›®çš„å¤æ‚æ€§ã€‚
2. **ä»£ç ä¼˜åŒ–**ï¼šåˆå¹¶äº†`import`è¯­å¥ï¼Œæå‡äº†ä»£ç çš„å¯è¯»æ€§ã€‚
3. **åŠŸèƒ½å¢å¼º**ï¼šå¼•å…¥äº†æ–°çš„æ¨¡å‹`GPT4o`ï¼Œå¢å¼ºäº†ä»£ç è¯„å®¡çš„çµæ´»æ€§ã€‚
4. **æ³¨é‡Šæ¸…æ™°**ï¼šå¢åŠ äº†æ³¨é‡Šï¼Œè§£é‡Šäº†ä»£ç çš„åŠŸèƒ½å’Œç›®çš„ã€‚
#### ğŸ¤”é—®é¢˜ç‚¹ï¼š
1. **ç¡¬ç¼–ç çš„Token**ï¼šåœ¨`codeReview`æ–¹æ³•ä¸­ï¼Œå­˜åœ¨ç¡¬ç¼–ç çš„Tokenï¼Œå­˜åœ¨å®‰å…¨é£é™©ã€‚
2. **æœªå¤„ç†çš„å¼‚å¸¸**ï¼šåœ¨`codeReview`æ–¹æ³•ä¸­ï¼Œæœªå¯¹`IOException`è¿›è¡Œè¯¦ç»†å¤„ç†ï¼Œå¯èƒ½å¯¼è‡´æ½œåœ¨çš„å¼‚å¸¸æœªè¢«æ•è·ã€‚
3. **ä»£ç å†—ä½™**ï¼šéƒ¨åˆ†æ³¨é‡Šä»£ç æœªè¢«åˆ é™¤ï¼Œå½±å“ä»£ç çš„æ•´æ´æ€§ã€‚
4. **å‘½åä¸ä¸€è‡´**ï¼šå˜é‡å‘½åä¸å¤Ÿç»Ÿä¸€ï¼Œå¯èƒ½å¯¼è‡´æ··æ·†ã€‚
#### ğŸ¯ä¿®æ”¹å»ºè®®ï¼š
1. **ç§»é™¤ç¡¬ç¼–ç çš„Token**ï¼šå°†Tokenå­˜å‚¨åœ¨é…ç½®æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡ä¸­ï¼Œé¿å…ç¡¬ç¼–ç ã€‚
2. **è¯¦ç»†å¤„ç†å¼‚å¸¸**ï¼šå¯¹`IOException`è¿›è¡Œè¯¦ç»†å¤„ç†ï¼Œç¡®ä¿æ‰€æœ‰å¼‚å¸¸éƒ½èƒ½è¢«æ•è·å¹¶å¤„ç†ã€‚
3. **æ¸…ç†å†—ä½™ä»£ç **ï¼šåˆ é™¤æ‰€æœ‰ä¸å¿…è¦çš„æ³¨é‡Šä»£ç ï¼Œä¿æŒä»£ç æ•´æ´ã€‚
4. **ç»Ÿä¸€å‘½åè§„èŒƒ**ï¼šç¡®ä¿å˜é‡å‘½åä¸€è‡´ï¼Œæå‡ä»£ç å¯è¯»æ€§ã€‚
#### ğŸ’»ä¿®æ”¹åçš„ä»£ç ï¼š
```java
// Yby6OpenAiCodeReview.java
import com.yby6.middleware.sdk.utils.BearerTokenUtils;
import com.yby6.middleware.sdk.utils.GitHubUploader;
import com.yby6.middleware.sdk.utils.WXAccessTokenUtils;

import java.io.*;
import java.net.HttpURLConnection;
import java.net.URL;
import java.nio.charset.StandardCharsets;
import java.util.ArrayList;

public class Yby6OpenAiCodeReview {
    public static void main(String[] args) {
        // Your main method implementation
    }

    private static String codeReview(String model, String diffCode) throws IOException {
        String token, llmUrl;
        if (model.contains("gpt")) {
            llmUrl = "https://api.mihoyo.bf/v1/chat/completions";
            token = System.getenv("GPT_API_TOKEN");
        } else {
            llmUrl = "https://open.bigmodel.cn/api/paas/v4/chat/completions";
            token = BearerTokenUtils.getToken(apiKeySecret);
        }
        URL url = new URL(llmUrl);
        HttpURLConnection connection = (HttpURLConnection) url.openConnection();

        connection.setRequestMethod("POST");
        connection.setRequestProperty("Authorization", "Bearer " + token);
        connection.setRequestProperty("Content-Type", "application/json");
        connection.setDoOutput(true);

        ChatCompletionRequest chatCompletionRequest = new ChatCompletionRequest();
        chatCompletionRequest.setModel(model);
        chatCompletionRequest.setMessages(new ArrayList<ChatCompletionRequest.Prompt>() {
            private static final long serialVersionUID = -7988151926241837899L;
            {
                add(new ChatCompletionRequest.Prompt("system", "Your system message here"));
                add(new ChatCompletionRequest.Prompt("user", diffCode));
            }
        });

        try (OutputStream os = connection.getOutputStream()) {
            byte[] input = chatCompletionRequest.toString().getBytes(StandardCharsets.UTF_8);
            os.write(input, 0, input.length);
        }

        int responseCode = connection.getResponseCode();
        if (responseCode != HttpURLConnection.HTTP_OK) {
            throw new IOException("HTTP error code: " + responseCode);
        }

        try (BufferedReader br = new BufferedReader(new InputStreamReader(connection.getInputStream(), StandardCharsets.UTF_8))) {
            StringBuilder response = new StringBuilder();
            String responseLine;
            while ((responseLine = br.readLine()) != null) {
                response.append(responseLine.trim());
            }
            return response.toString();
        }
    }
}
```
